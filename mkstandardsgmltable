#!/usr/bin/perl

use Carp;
use Getopt::Long;
use Mysql;

use Env qw(LSBUSER LSBDBPASSWD LSBDB LSBDBHOST);

GetOptions("r" => \$doref);

$Dbh = Mysql->connect($LSBDBHOST,$LSBDB,$LSBUSER,$LSBDBPASSWD) || die $Mysql::db_errstr;

if( $doref ) {
	$select = "SELECT * FROM Standard WHERE Stype='Reference' ";
} else {
	$select = "SELECT * FROM Standard WHERE Stype='Standard' ";
}
$select.= "ORDER BY Sname";

#printf $select,"\n";
$sth = $Dbh->query($select) || die $Dbh->errmsg();

printf("<!-- Start of text generated from database -->\n");
printf("<!-- generated from the LSB specification database -->\n");
printf("<!--    by \$Header: /home/mats.deb/cvsrepo/lsb/lsbspec.smaller/mkstandardsgmltable,v 1.5 2001-12-24 15:37:37 anderson Exp $- -->\n");
my $now_string = localtime;
printf("<!--    at %s -->\n", $now_string );

print "<TBODY>\n";
for(1..$sth->numrows) {
	%entry=$sth->fetchhash;
	print "<ROW>";
	# Don't print the nickname. It may be confusing
	#printf "<ENTRY>%s</ENTRY>",$entry{'Sname'};
	printf "<ENTRY>%s</ENTRY>",$entry{'Sfull'};
	printf "<ENTRY><ULINK URL=\"%s\">%s</ULINK></ENTRY>",
					$entry{'Surl'}, $entry{'Surl'};
	printf "<ENTRY>%s</ENTRY>",$entry{'Scomment'};
	print "</ROW>\n";
}
print "</TBODY>\n";
printf("<!-- End of text generated from database -->\n");
printf("<!--    by \$Header: /home/mats.deb/cvsrepo/lsb/lsbspec.smaller/mkstandardsgmltable,v 1.5 2001-12-24 15:37:37 anderson Exp $- -->\n");
