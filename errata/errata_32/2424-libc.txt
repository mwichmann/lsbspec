Specification: LSB Core Generic
Specification: LSB Core IA32, IA64, PPC32, PPC64, S390, S390X, AMD64
Edition of Specification: 3.2
Type: Error
Status: Unapproved, new text
Bug reference: http://bugs.linuxbase.org/show_bug.cgi?id=2423

Rationale: the specification incorrectly requires that the __xstat,
__lxstat and __fxstat binary-only functions were to be called with an
invariant value of 3 or the results are undefined.  Similarly, it requires
that __xmknod be called with an invariant value of 1 or the results are
undefined. In fact, these two values vary based on architecture. Some
other minor corrections are also needed.

In LSB Core Generic:

=== modified file 'LSB-Core-generic/LSB-Core-generic.txt'

In 13.5. Interface Definitions for libc

In the interface list remove:

   __lxstat -- inline wrapper around call to lxstat

and change:

   __xmknod -- make block or character special file

to:

   __xmknod -- make a special file
 

In the interface defintions for __lxstat, remove the entire entry.
This function is covered in the combined __xstat section and should
not be duplicated.

In the interface definitions for __xmknod,
Section Name, change:

   __xmknod -- make block or character special file

To:

   __xmknod -- make a special file

Section Synopsis, insert:
 
   #include <sys/stat.h>

 
Section Description, change:
 
   The __xmknod() function shall implement the mknod() interface
   from ISO POSIX (2003).

   The value of ver shall be 1 or the behavior of __xmknod() is
   undefined.

   __xmknod(1, path, mode, dev) shall behave as mknod(path, mode,
   dev) as specified by ISO POSIX (2003).

To:

   The __xmknod() function shall implement the mknod() interface.
   The behavior of __xmknod() for values of ver other than
   _MKNOD_VER is undefined. See Data Definitions in the
   architecture specific part of this specification for the
   correct value of _MKNOD_VER.

   __xmknod(_MKNOD_VER, path, mode, dev) shall behave as
   mknod(path, mode, dev) as specified by ISO POSIX (2003).
 

In the interface definitions for __xstat,
Section Description, change:
 
   The functions __xstat(), __lxstat(), and __fxstat() shall
   implement the ISO POSIX (2003) functions stat(), lstat(), and
   fstat() respectively.

   ver shall be 3 or the behavior of these functions is undefined.

   __xstat(3, path, stat_buf) shall implement stat(path, stat_buf)
   as specified by ISO POSIX (2003).

   __lxstat(3, path, stat_buf) shall implement lstat(path,
   stat_buf) as specified by ISO POSIX (2003).

   __fxstat(3, fildes, stat_buf) shall implement fstat(fildes,
   stat_buf) as specified by ISO POSIX (2003).

To:

   The functions __xstat(), __lxstat(), and __fxstat() shall
   implement the functions stat(), lstat(), and fstat()
   respectively.

   The behavior of these functions for values of ver other than
   _STAT_VER is undefined. See Data Definitions in the
   architecture specific part of this specification for the
   correct value of _STAT_VER.

   __xstat(_STAT_VER, path, stat_buf) shall implement stat(path,
   stat_buf) as specified by ISO POSIX (2003).

   __lxstat(_STAT_VER, path, stat_buf) shall implement lstat(path,
   stat_buf) as specified by ISO POSIX (2003).

   __fxstat(_STAT_VER, fildes, stat_buf) shall implement
   fstat(fildes, stat_buf) as specified by ISO POSIX (2003).
 

In the interface definitions for __xstat64,
Section Description, change:
 
   The functions __xstat64(), __lxstat64(), and __fxstat64() shall
   implement the Large File Support functions stat64(), lstat64(),
   and fstat64() respectively.

   ver shall be 3 or the behavior of these functions is undefined.

   __xstat64(3, path, stat_buf) shall behave as stat(path,
   stat_buf) as specified by Large File Support.

   __lxstat64(3, path, stat_buf) shall behave as lstat(path,
   stat_buf) as specified by Large File Support.

   __fxstat64(3, fildes, stat_buf) shall behave as fstat(fildes,
   stat_buf) as specified by Large File Support.

To:

   The functions __xstat64(), __lxstat64(), and __fxstat64() shall
   implement the functions stat64(), lstat64(), and fstat64()
   respectively.

   The behavior of these functions for values of ver other than
   _STAT_VER is undefined. See Data Definitions in the
   architecture specific part of this specification for the
   correct value of _STAT_VER.

   __xstat64(_STAT_VER, path, stat_buf) shall behave as
   stat64(path, stat_buf) as specified by Large File Support.

   __lxstat64(_STAT_VER, path, stat_buf) shall behave as
   lstat64(path, stat_buf) as specified by Large File Support.

   __fxstat64(_STAT_VER, fildes, stat_buf) shall behave as
   fstat64(fildes, stat_buf) as specified by Large File Support.
 

===
In LSB Core IA32, PPC32, S390:

In 11.3. Data Definitions for libc.
In 11.3.48. sys/stat.h, insert:

#define _MKNOD_VER      1


===
In LSB Core IA64, PPC64, S390X, AMD64:

In 11.3. Data Definitions for libc.
In 11.3.48. sys/stat.h, insert:

#define _MKNOD_VER      0
